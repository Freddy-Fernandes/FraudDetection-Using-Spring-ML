<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection System - Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #0B3C5D 0%, #000000 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #000000;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #000000;
        }
        
        .validity {
            color: red;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        button {
            background: linear-gradient(135deg, #0F766E 0%, #000000 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        
        .result.danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result h3 {
            margin-bottom: 10px;
        }
        
        .result-detail {
            margin: 5px 0;
        }
        
.input-error {
    border: 2px solid red !important;
}

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge.safe {
            background: #28a745;
            color: white;
        }
        
        .badge.suspicious {
            background: #ffc107;
            color: #333;
        }
        
        .badge.fraud {
            background: #dc3545;
            color: white;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #000000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
    <div class="header">
        <h1>Fraud Detection System</h1>
        <p>Real-time ML-powered fraud prevention</p>
    </div>

    <div class="content">
        <!-- Register User Section -->
        <div class="section">
            <h2>1. Register User</h2>

            <div class="form-group">
                <label>Email</label>
                <input 
                    type="email"
                    id="email"
                    placeholder="Valid email"
                    required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                    title="Enter a valid email (example: name@gmail.com)">
                    <small id="emailError" class="validity"></small>
            </div>

            <div class="form-group">
                <label>Name</label>
                <input 
                    type="text"
                    id="name"
                    placeholder="Enter full name"
                    required
                    minlength="3">
                <small id="nameError" class="validity"></small>
            </div>

            <div class="form-group">
                <label>Phone Number</label>
                <input 
                    type="tel"
                    id="phone"
                    placeholder="Valid 10-digit phone number"
                    required
                    pattern="[0-9]{10}"
                    maxlength="10"
                    minlength="10"
                    inputmode="numeric"
                    oninput="this.value=this.value.replace(/[^0-9]/g,'')"
                    title="Phone number must be exactly 10 digits">
                    <small id="phoneError" class="validity"></small>
            </div>

            <button type="button" onclick="registerUser()">Register User</button>
            <div id="registerResult" class="result"></div>
        </div>

        <!-- Process Transaction Section -->
        <div class="section">
            <h2>2. Process Transaction</h2>

            <div class="form-group">
                <label>User ID</label>
                <input type="text" id="userId" placeholder="Will be filled after registration">
            </div>

            <div class="form-group">
                <label>Amount [Rs]</label>
                <input 
                    type="number"
                    id="amount"
                    placeholder="Enter a value"
                    min="10"
                    max="50000"
                    step="0.01"
                    required>
            </div>

            <div class="form-group">
                <label>Transaction Type</label>
                <select id="transactionType">
                    <option value="UPI">UPI</option>
                    <option value="QR_CODE">QR Code</option>
                    <option value="CARD">Card</option>
                    <option value="WALLET">Wallet</option>
                </select>
            </div>

            <div class="form-group">
                <label>Merchant Name</label>
                <input type="text" id="merchantName" required>
            </div>
                <div class="form-group">
                    <label>Device ID</label>
                    <input type="text" id="deviceId" value="DEVICE-001">
                </div>

            <button type="button" onclick="processTransaction()">Process Transaction</button>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Analyzing transaction...</p>
            </div>

            <div id="transactionResult" class="result"></div>
            <!-- Fraud Test Scenarios -->
            <div class="section">
                <h2>3. Test Fraud Scenarios</h2>
                <button type="button" onclick="testHighAmount()">Test High Amount (Suspicious)</button>
                <button type="button" onclick="testNewDevice()">Test New Device (Alert)</button>
                <button type="button" onclick="testVelocity()">Test High Velocity (Multiple Transactions)</button>
        </div></div>
    </div>
</div>
    <script>
        const API_BASE = 'http://localhost:8080/api';
        let currentUserId = '';

        async function registerUser() {
            const emailEl = document.getElementById("email");
    const phoneEl = document.getElementById("phone");
    const nameEl = document.getElementById("name");

    const emailError = document.getElementById("emailError");
    const phoneError = document.getElementById("phoneError");
    const nameError = document.getElementById("nameError");

    const email = emailEl.value.trim();
    const phone = phoneEl.value.trim();
    const name = nameEl.value.trim();

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phoneRegex = /^[0-9]{10}$/;

    let valid = true;

    // Reset states
    [emailEl, phoneEl, nameEl].forEach(el => el.classList.remove("input-error"));
    [emailError, phoneError, nameError].forEach(el => el.style.display = "none");

    // Email validation
    if (!emailRegex.test(email)) {
        emailEl.classList.add("input-error");
        emailError.innerText = "Enter valid email (example: name@gmail.com)";
        emailError.style.display = "block";
        valid = false;
    }

    // Phone validation
    if (!phoneRegex.test(phone)) {
        phoneEl.classList.add("input-error");
        phoneError.innerText = "Phone must be exactly 10 digits";
        phoneError.style.display = "block";
        valid = false;
    }

    // Name validation
    if (name.length < 3) {
        nameEl.classList.add("input-error");
        nameError.innerText = "Name must be at least 3 characters";
        nameError.style.display = "block";
        valid = false;
    }
    if (!valid) {
    return;   // THIS stops user from being registered
}
            const data = {
                email: document.getElementById('email').value,
                name: document.getElementById('name').value,
                phoneNumber: document.getElementById('phone').value,
                password: 'SecurePass123'
            };

            try {
                const response = await fetch(`${API_BASE}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                const resultDiv = document.getElementById('registerResult');
                
                if (response.ok) {
                    currentUserId = result.userId;
                    document.getElementById('userId').value = currentUserId;
                    resultDiv.className = 'result success';
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = `
                        <h3>✅ User Registered Successfully</h3>
                        <div class="result-detail"><strong>User ID:</strong> ${result.userId}</div>
                        <div class="result-detail"><strong>Trust Score:</strong> ${result.trustScore}</div>
                    `;
                } else {
                    resultDiv.className = 'result danger';
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = '<h3>❌ Registration Failed</h3><p>User may already exist</p>';
                }
            } catch (error) {
                showError('registerResult', error);
            }
        }

        async function processTransaction() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                alert('Please register a user first!');
                return;
            }

            const data = {
                userId: userId,
                amount: parseFloat(document.getElementById('amount').value),
                currency: 'INDIA',
                transactionType: document.getElementById('transactionType').value,
                merchantName: document.getElementById('merchantName').value,
                merchantId: 'MERCH-' + Math.floor(Math.random() * 1000),
                merchantCategory: 'RETAIL',
                ipAddress: '192.168.1.100',
                country: 'INDIA',
                city: 'New Delhi',
                deviceId: document.getElementById('deviceId').value,
                deviceType: 'MOBILE'
            };

            document.getElementById('loading').style.display = 'block';
            document.getElementById('transactionResult').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/transactions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('loading').style.display = 'none';
                showTransactionResult(result);
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                showError('transactionResult', error);
            }
        }

        function showTransactionResult(result) {
            const resultDiv = document.getElementById('transactionResult');
            let className = 'result ';
            
            if (result.fraudStatus === 'SAFE') {
                className += 'success';
            } else if (result.fraudStatus === 'SUSPICIOUS') {
                className += 'warning';
            } else {
                className += 'danger';
            }

            const badgeClass = result.fraudStatus === 'SAFE' ? 'safe' : 
                               result.fraudStatus === 'SUSPICIOUS' ? 'suspicious' : 'fraud';

            resultDiv.className = className;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>${result.approved ? '✅' : '❌'} Transaction ${result.status}</h3>
                <div class="result-detail">
                    <strong>Transaction ID:</strong> ${result.transactionId}
                </div>
                <div class="result-detail">
                    <strong>Fraud Status:</strong> 
                    <span class="badge ${badgeClass}">${result.fraudStatus}</span>
                </div>
                <div class="result-detail">
                    <strong>Fraud Score:</strong> ${(result.fraudScore * 100).toFixed(1)}%
                </div>
                <div class="result-detail">
                    <strong>Risk Level:</strong> ${result.fraudAnalysis?.riskLevel || 'N/A'}
                </div>
                <div class="result-detail">
                    <strong>Reason:</strong> ${result.fraudReason}
                </div>
                <div class="result-detail">
                    <strong>Recommendation:</strong> ${result.fraudAnalysis?.recommendation || 'N/A'}
                </div>
                ${result.fraudAnalysis?.triggeredRules?.length > 0 ? `
                    <div class="result-detail">
                        <strong>Triggered Rules:</strong> ${result.fraudAnalysis.triggeredRules.join(', ')}
                    </div>
                ` : ''}
            `;
        }

        async function testHighAmount() {
            document.getElementById('amount').value = '10000.00';
            await processTransaction();
        }

        async function testNewDevice() {
            document.getElementById('deviceId').value = 'DEVICE-NEW-' + Math.floor(Math.random() * 10000);
            await processTransaction();
        }

        async function testVelocity() {
            const amount = document.getElementById('amount').value;
            document.getElementById('amount').value = '30.00';
            
            for (let i = 0; i < 3; i++) {
                await processTransaction();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            document.getElementById('amount').value = amount;
        }

        function showError(elementId, error) {
            const resultDiv = document.getElementById(elementId);
            resultDiv.className = 'result danger';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>❌ Error</h3><p>${error.message}</p>`;
        }
    </script>
</body>
</html>